<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="article">


    <!-- 리스트 조회   -->
    <select id="getArticleList" parameterType="HashMap" resultType="HashMap">
		 SELECT *  
		 FROM
			(SELECT 
			idx,datanum,reply,parent,
			is_comment,comment,comment_reply,cat_id,
			subject,content,link1,link2,
			link1_hit,link2_hit,trackback,
			hit,good,nogood,mb_id,
			password,name,email,homepage,
			datetime,last,ip,
			DATE_FORMAT(datetime, '%Y%m%d') AS date
			FROM IS_BOARD DATA ORDER BY DATANUM DESC) core,
			(SELECT date_format(datetime, '%Y%m%d') dummyDate, count(*) datecnt  FROM is_board
 			GROUP BY date_format(datetime, '%Y%m%d')) dummy WHERE core.date = dummy.dummyDate;                
       <!--
        <where> 
            <if test="type != null and keyword != null">
                ${type} LIKE ${keyword}
            </if>           
        </where>
            <if test="startArticleNum != null and endArticleNum != null">               
                 LIMIT ${startArticleNum}, ${endArticleNum}    
            </if>
		-->                                     
    </select>  

    <!-- 전체 레코드 조회   -->
    <select id="getTotalNum" parameterType="HashMap" resultType="int">
        SELECT COUNT(*) FROM IS_BOARD         
        <where> 
            <if test="type != null and keyword != null">
                ${type} LIKE ${keyword}
            </if>
        </where>
        
    </select>
    
    <!-- 게시물 조회   -->
    <select id="getArticle" parameterType="int" resultType="Article">        
        SELECT 
            * 
        FROM IS_BOARD                      
        WHERE DATANUM = #{datanum}        
    </select>      
    
    <!-- 게시물 등록 -->
    <insert id="insertArticle" parameterType="Article" keyProperty="datanum">
        <selectKey keyProperty="datanum" resultType="int" order="BEFORE">
            SELECT COALESCE(MAX(datanum), 0) + 1 AS datanum 
            FROM IS_BOARD
        </selectKey>
        
        INSERT INTO IS_BOARD (
              datanum, reply, parent, is_comment
            , comment, comment_reply, cat_id, subject
            , content , link1, link2, link1_hit
            , link2_hit, trackback, hit, good
            , nogood, mb_id, password, name
            , email, homepage, datetime, last, ip)
        values (
              #{datanum}, ' ', 0, 0
            , 0, ' ', #{cat_id}, #{subject}
            , #{content}, ' ', ' ', 0
            , 0, ' ', 0, 0
            , 0, #{mb_id}, #{password}, #{name} 
            , #{email}, ' ', NOW(), ' ', ' ')
    </insert>
    
    <!-- 게시물 수정 -->
    <update id="update">
        UPDATE  t_sample
        SET
              datanum, reply, parent, is_comment
            , comment, comment_reply, cat_id, subject
            , content , link1, link2, link1_hit
            , link2_hit, trackback, hit, good
            , nogood, mb_id, password, name
            , email, homepage, datetime, last, ip)
        WHERE  datanum    = #{datanum}
    </update>    
    
    
    <!-- 게시물 삭제 -->
    <delete id="deleteArticle" parameterType="int">
        DELETE 
        FROM    IS_BOARD
        WHERE  datanum = #{datanum}
    </delete>
 
</mapper>